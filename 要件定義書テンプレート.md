# 要件定義書テンプレート

**プロジェクト名:** [プロジェクト名を記載]  
**作成日:** [YYYY/MM/DD]  
**最終更新日:** [YYYY/MM/DD]  
**作成者:** [作成者名]  
**承認者:** [承認者名]  
**バージョン:** [バージョン番号]

---

## 1. プロジェクト概要

### 1.1 背景・目的
**背景:**
- [プロジェクトが必要になった背景を記載]
- [現在の問題点や課題を具体的に記載]

**目的:**
- [プロジェクトの目的を明確に記載]
- [解決したい問題を具体的に記載]

### 1.2 スコープ
**含まれる範囲:**
- [開発対象となる機能や範囲を記載]
- [対象ユーザー層を記載]

**含まれない範囲:**
- [今回のプロジェクトで対象外となる項目を記載]
- [将来的な機能拡張予定があれば記載]

### 1.3 成功基準
- [プロジェクトの成功を測る具体的な指標を記載]
- [定量的な目標値を設定]

---

## 2. ステークホルダー

### 2.1 関係者一覧
| 役割 | 氏名/組織 | 責任範囲 | 連絡先 |
|------|-----------|----------|--------|
| プロダクトオーナー | [氏名] | [責任範囲] | [連絡先] |
| 開発リーダー | [氏名] | [責任範囲] | [連絡先] |
| システム管理者 | [氏名] | [責任範囲] | [連絡先] |
| エンドユーザー代表 | [氏名] | [責任範囲] | [連絡先] |

---

## 3. 機能要件

### 3.1 ユーザーストーリー
**優先度:** 高/中/低で分類

#### 3.1.1 [機能名A]
**優先度:** 高  
**ユーザーストーリー:** [ユーザー]として、[目的]のために、[機能]を使いたい。

**受け入れ条件:**
- [ ] [具体的な条件1]
- [ ] [具体的な条件2]
- [ ] [具体的な条件3]

**備考:**
- [追加の説明や制約事項]

#### 3.1.2 [機能名B]
**優先度:** 中  
**ユーザーストーリー:** [ユーザー]として、[目的]のために、[機能]を使いたい。

**受け入れ条件:**
- [ ] [具体的な条件1]
- [ ] [具体的な条件2]

### 3.2 画面・UI要件
#### 3.2.1 画面一覧
| 画面名 | 概要 | 優先度 | 備考 |
|--------|------|--------|------|
| [画面名1] | [概要] | 高 | [備考] |
| [画面名2] | [概要] | 中 | [備考] |

#### 3.2.2 UI/UX要件
- [ユーザビリティ要件を記載]
- [アクセシビリティ要件を記載]
- [レスポンシブデザイン要件を記載]

### 3.3 外部システム連携
#### 3.3.1 連携システム一覧
| システム名 | 連携方式 | データ形式 | 頻度 |
|------------|----------|------------|------|
| [システム名1] | [REST API等] | [JSON等] | [リアルタイム等] |
| [システム名2] | [バッチ処理等] | [CSV等] | [日次等] |

---

## 4. 非機能要件

### 4.1 性能要件
**応答時間:**
- 画面表示: [X]秒以内
- データ処理: [X]秒以内
- バッチ処理: [X]時間以内

**スループット:**
- 同時接続ユーザー数: [X]人
- 1日あたりの処理件数: [X]件

### 4.2 可用性要件
**稼働時間:**
- 稼働率: [99.X]%
- メンテナンス時間: [平日/土日] [時間帯]

**障害対応:**
- 障害検知時間: [X]分以内
- 復旧時間: [X]時間以内

### 4.3 セキュリティ要件
**認証・認可:**
- ユーザー認証方式: [方式を記載]
- アクセス権限管理: [管理方法を記載]

**データ保護:**
- 暗号化要件: [暗号化方式と対象データ]
- 個人情報保護: [保護対策を記載]

### 4.4 運用保守要件
**監視:**
- システム監視項目: [監視対象を記載]
- ログ保存期間: [期間を記載]

**バックアップ:**
- バックアップ頻度: [頻度を記載]
- バックアップ保存期間: [期間を記載]

---

## 5. 技術要件（Pygonスタイル準拠）

### 5.1 開発環境
**プログラミング言語:**
- Python 3.11以上（Pygonスタイル準拠）

**フレームワーク・ライブラリ:**
- [使用するフレームワーク名とバージョン]
- [必要なライブラリを記載]

**開発ツール:**
- mypy（型チェック）
- ruff（リンティング）
- pytest（テスト）
- pre-commit（コミット前チェック）

### 5.2 アーキテクチャ要件
**設計原則（Pygonスタイル準拠）:**
- 明示的エラーハンドリング（戻り値でエラーを返す）
- 徹底した型注釈（TypeAlias活用）
- シンプルなデータ構造（@dataclass(frozen=True)）
- 単一責任の関数
- 暗黙的動作の排除

**ディレクトリ構造:**
```
project/
├── src/
│   ├── types/           # Result型の集約
│   ├── models/          # @dataclass, Enum
│   ├── validators/      # バリデーション関数
│   ├── services/        # ビジネスロジック関数
│   ├── repositories/    # データアクセス関数
│   ├── protocols/       # インターフェース定義
│   ├── config/          # 設定・定数
│   └── utils/           # ユーティリティ関数
├── tests/
│   ├── unit/           # 単体テスト
│   ├── integration/    # 結合テスト
│   └── fixtures/       # テストデータ
├── PYGON.md           # スタイルガイド
├── README.md          # プロジェクト概要
└── TODO.md            # タスク・AI協調記録
```

### 5.3 エラーハンドリング戦略
**基本パターン:**
```python
# 単一エラー（fail fast）
def validate_data(data: dict) -> tuple[bool, str | None]:
    if not data.get("email"):
        return False, "validation_error: email is required"
    return True, None

# 複数エラー（UX重視）
def validate_form(form_data: dict) -> tuple[bool, list[str]]:
    errors = []
    if not form_data.get("name"):
        errors.append("validation_error: name is required")
    return len(errors) == 0, errors
```

**Result型定義:**
```python
from typing import TypeVar, TypeAlias

T = TypeVar('T')
Result: TypeAlias = tuple[T | None, str | None]
ValidationResult: TypeAlias = tuple[bool, str | None]
MultipleErrorResult: TypeAlias = tuple[bool, list[str]]
```

### 5.4 データベース要件
**RDBMS:**
- [使用するデータベース名とバージョン]
- [接続プール設定]

**NoSQL:**
- [必要に応じて記載]

---

## 6. データモデル

### 6.1 エンティティ一覧
| エンティティ名 | 概要 | 主要属性 |
|----------------|------|----------|
| [エンティティ1] | [概要] | [属性1, 属性2, ...] |
| [エンティティ2] | [概要] | [属性1, 属性2, ...] |

### 6.2 データ構造例（Pygonスタイル）
```python
from dataclasses import dataclass
from typing import Optional
from enum import Enum

class UserStatus(Enum):
    ACTIVE = "active"
    INACTIVE = "inactive"
    SUSPENDED = "suspended"

@dataclass(frozen=True)
class User:
    id: int
    name: str
    email: str
    status: UserStatus
    created_at: str
    # メソッドなし - データのみ

# 処理は関数として分離
def is_user_active(user: User) -> bool:
    return user.status == UserStatus.ACTIVE

def update_user_status(user: User, new_status: UserStatus) -> User:
    return User(user.id, user.name, user.email, new_status, user.created_at)
```

---

## 7. API仕様

### 7.1 REST API一覧
| エンドポイント | メソッド | 概要 | 入力 | 出力 |
|----------------|----------|------|------|------|
| /api/users | GET | ユーザー一覧取得 | クエリパラメータ | ユーザー配列 |
| /api/users | POST | ユーザー作成 | ユーザー情報 | 作成結果 |
| /api/users/{id} | GET | ユーザー詳細取得 | ユーザーID | ユーザー詳細 |
| /api/users/{id} | PUT | ユーザー更新 | ユーザー情報 | 更新結果 |
| /api/users/{id} | DELETE | ユーザー削除 | ユーザーID | 削除結果 |

### 7.2 エラーレスポンス仕様
**標準エラーフォーマット:**
```json
{
  "error": {
    "type": "validation_error",
    "message": "入力データが不正です",
    "details": [
      "email is required",
      "password is too short"
    ],
    "timestamp": "2025-06-10T16:52:00Z"
  }
}
```

---

## 8. テスト要件

### 8.1 テスト戦略
**テストレベル:**
- 単体テスト（Unit Test）: 個別関数のテスト
- 結合テスト（Integration Test）: システム間連携のテスト
- システムテスト（System Test）: エンドツーエンドのテスト

### 8.2 Pygonスタイルテストパターン
```python
class TestEmailValidation:
    def test_valid_email_returns_success(self):
        result, error = validate_email_format("user@example.com")
        assert error is None
        assert result is True
    
    def test_invalid_email_returns_error(self):
        result, error = validate_email_format("invalid-email")
        assert result is False
        assert "validation_error" in error

    def test_empty_email_returns_specific_error(self):
        result, error = validate_email_format("")
        assert result is False
        assert error == "validation_error: email is required"
```

### 8.3 テストカバレッジ
**目標カバレッジ:**
- 単体テスト: 90%以上
- 結合テスト: 80%以上

**必須テストケース:**
- 正常系（成功ケース）
- 異常系（エラーケース）
- 境界値テスト
- エラーメッセージ検証

---

## 9. 開発・運用環境

### 9.1 環境構成
| 環境 | 用途 | URL | 備考 |
|------|------|-----|------|
| 開発環境 | 開発・デバッグ | [URL] | [備考] |
| テスト環境 | 品質確認 | [URL] | [備考] |
| ステージング環境 | 本番前確認 | [URL] | [備考] |
| 本番環境 | サービス提供 | [URL] | [備考] |

### 9.2 CI/CD要件
**継続的インテグレーション:**
- コミット時の自動テスト実行
- 型チェック（mypy）
- リンティング（ruff）
- テストカバレッジ計測

**継続的デプロイメント:**
- 自動デプロイフロー
- ロールバック手順
- 環境別デプロイ設定

---

## 10. プロジェクト管理

### 10.1 開発プロセス
**開発手法:**
- アジャイル開発（スクラム/カンバン）
- TDD（テスト駆動開発）
- AI協調開発

**Pygon TDDサイクル:**
1. テスト作成
2. 最小実装
3. リファクタリング（関数分割・責任分離）

### 10.2 コミュニケーション
**定期ミーティング:**
- 日次スタンドアップ: [頻度] [時間]
- スプリントレビュー: [頻度] [時間]
- レトロスペクティブ: [頻度] [時間]

**コミュニケーションツール:**
- チャット: [ツール名]
- タスク管理: [ツール名]
- ドキュメント共有: [ツール名]

### 10.3 品質管理
**コードレビュー:**
- プルリクエスト必須
- レビュアー: [最低人数]
- Pygonスタイルガイド準拠チェック

**品質基準:**
- [ ] 全関数に明示的な戻り値型
- [ ] エラーハンドリングが適切
- [ ] dataclassはimmutable（frozen=True）
- [ ] 単一責任の原則遵守
- [ ] 英語コメントのみ使用
- [ ] テストカバレッジ目標達成

---

## 11. スケジュール

### 11.1 マイルストーン
| フェーズ | 開始日 | 終了日 | 成果物 | 責任者 |
|----------|--------|--------|--------|--------|
| 要件定義 | [日付] | [日付] | 要件定義書 | [責任者] |
| 基本設計 | [日付] | [日付] | 基本設計書 | [責任者] |
| 詳細設計 | [日付] | [日付] | 詳細設計書 | [責任者] |
| 実装フェーズ1 | [日付] | [日付] | 基本機能 | [責任者] |
| 実装フェーズ2 | [日付] | [日付] | 応用機能 | [責任者] |
| テストフェーズ | [日付] | [日付] | テスト完了 | [責任者] |
| リリース | [日付] | [日付] | 本番稼働 | [責任者] |

### 11.2 リスクと対策
| リスク | 影響度 | 発生確率 | 対策 | 責任者 |
|--------|--------|----------|------|--------|
| [リスク1] | 高/中/低 | 高/中/低 | [対策内容] | [責任者] |
| [リスク2] | 高/中/低 | 高/中/低 | [対策内容] | [責任者] |

---

## 12. 承認

### 12.1 承認者一覧
| 役割 | 氏名 | 承認日 | 署名 |
|------|------|--------|------|
| プロダクトオーナー | [氏名] | [日付] | [署名] |
| 開発リーダー | [氏名] | [日付] | [署名] |
| 品質管理者 | [氏名] | [日付] | [署名] |

### 12.2 変更履歴
| バージョン | 変更日 | 変更者 | 変更内容 |
|------------|--------|--------|----------|
| 1.0 | [日付] | [変更者] | 初版作成 |
| 1.1 | [日付] | [変更者] | [変更内容] |

---

## 付録

### A. 参照ドキュメント
- [PYGON.md](./PYGON.md) - Pygonスタイルガイド
- [README.md](./README.md) - プロジェクト概要
- [TODO.md](./TODO.md) - 開発タスク

### B. 用語集
| 用語 | 定義 |
|------|------|
| Pygon | Python × Go の融合スタイル。明示的で理解しやすいコーディング手法 |
| Result型 | `tuple[T | None, str | None]` パターンによる明示的エラーハンドリング |
| frozen dataclass | 不変のデータクラス。`@dataclass(frozen=True)` で定義 |

### C. AI協調開発ガイドライン
**AI活用場面:**
- コード生成時の関数シグネチャ提供
- エラーパターンの一貫性確保
- テストケース生成
- コードレビュー支援

**AI協調のポイント:**
- 明確な関数シグネチャでAI支援を効果的に活用
- 型情報を活用してAIの理解を促進
- 単一責任関数でAIによる安全な修正を実現

---

**このテンプレートについて:**
この要件定義書テンプレートは、Pygonスタイルでの開発プロジェクトに特化して作成されています。明示的なエラーハンドリング、型安全性、AI協調開発を重視した要件を定義することで、保守性が高く、チーム開発に適したシステムの構築を支援します。