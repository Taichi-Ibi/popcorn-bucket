# 自動販売機システム要件定義書

## 1. システム概要

### システム名
自動販売機システム（Vending Machine API）

### 目的
- 自動販売機の基本的な操作（商品購入・在庫管理・売上集計）をREST APIで提供
- Python + インメモリDBで構築し、モデル生成やテスト自動化をAIで試せるサンプル基盤を構築

## 2. 背景・狙い

- AIアシスタントによるバックエンド生成性能を評価
- 在庫管理・決済ロジックを含む典型的なCRUD APIを網羅
- インメモリDBにより導入負荷を最小化し、アルゴリズム・API仕様に集中

## 3. 対象範囲

### 含む
- 商品一覧取得、購入、在庫補充、売上集計などのREST API
- 認証・認可は不要（サンプル用途のため省略）
- データ管理はインメモリDB（Pythonの辞書・リスト）

### 含まない
- フロントエンドUI
- 永続的なデータストア（SQLite・PostgreSQL等）
- 外部決済サービス連携

## 4. 機能要件

| 分類 | ID | 機能名 | 説明 |
|------|----|---------|----- |
| 商品管理 | F-01 | 商品一覧取得 | 全商品（ID・名称・価格・在庫数）を返却 |
| 商品管理 | F-02 | 商品詳細取得 | 指定IDの商品情報を返却 |
| 在庫管理 | F-03 | 在庫補充 | 指定IDの商品在庫を増加 |
| 購入処理 | F-04 | 購入実行 | 商品購入：在庫減少・売上記録 |
| 集計 | F-05 | 売上集計取得 | 期間指定による売上合計を返却 |
| ヘルスチェック | F-06 | サーバーヘルスチェック | 稼働状況を返却 |

## 5. 主なユースケース

1. クライアントが `GET /items` で商品一覧を取得
2. クライアントが `POST /purchase` で購入リクエスト
3. APIが在庫を検証し、成功なら在庫を減少・売上を記録、レスポンスを返却
4. 管理者が `POST /restock` で在庫補充
5. 管理者が `GET /sales?from=…&to=…` で売上集計を取得

## 6. 非機能要件

- **言語・フレームワーク**: Python 3.9+ / FastAPI（または Flask）
- **ドキュメント**: OpenAPI（自動生成）
- **テスト**: Pytest によるユニットテスト・APIテスト
- **ロギング**: 標準ライブラリ logging で各種操作を記録
- **デプロイ**: コンテナ化（Dockerfile）
- **パフォーマンス**: 同時100リクエスト程度を想定
- **セキュリティ**: 認証・認可はサンプル用途のため省略

## 7. API仕様（サンプル）

### 7.1 商品一覧取得
- **GET /items**
- **Response 200**

```json
[
  { "id": 1, "name": "コーラ", "price": 150, "stock": 10 },
  { "id": 2, "name": "お茶", "price": 120, "stock": 20 }
]
```

### 7.2 商品詳細取得
- **GET /items/{id}**
- **Response 200**

```json
{
  "id": 1,
  "name": "コーラ",
  "price": 150,
  "stock": 10
}
```

### 7.3 購入処理
- **POST /purchase**
- **Request Body**

```json
{ "item_id": 1, "quantity": 2 }
```

- **Response 200**

```json
{
  "success": true,
  "total_price": 300,
  "remaining_stock": 8
}
```

- **Response 400**

```json
{ "error": "在庫不足" }
```

### 7.4 在庫補充
- **POST /restock**
- **Request Body**

```json
{ "item_id": 1, "quantity": 5 }
```

- **Response 200**

```json
{
  "item_id": 1,
  "new_stock": 15
}
```

### 7.5 売上集計取得
- **GET /sales?from=2025-06-01&to=2025-06-12**
- **Response 200**

```json
{
  "from": "2025-06-01",
  "to": "2025-06-12",
  "total_sales": 4500
}
```

## 8. データモデル（イメージ）

```python
# インメモリで辞書・リストを用いて管理
items = {
    1: { "name": "コーラ", "price": 150, "stock": 10 },
    2: { "name": "お茶",   "price": 120, "stock": 20 },
    # ...
}
sales = []  # [{"item_id":1, "qty":2, "timestamp": datetime}, ...]
```

## 9. 制約事項

- インメモリDBは永続化されないため、再起動でリセットされる
- 認証・課金機構は対象外
- 同時実行制御（ロックなど）は簡略化

## 10. 開発スケジュール（例）

1. プロジェクトセットアップ & FastAPI導入（1日）
2. インメモリDB・モデル定義（1日）
3. 各API実装 & ドキュメント作成（2日）
4. ユニットテスト & APIテスト（1日）
5. Docker化・動作確認（1日）
